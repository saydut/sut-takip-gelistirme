<!-- templates/_hizli_islemler.html -->

<div class="flex items-center space-x-2">

    <!-- "Ana Panele Dön" butonu kaldırıldı -->

    <div class="relative inline-block text-left" id="hizli-islem-container">
        <div>
            <!-- DÜZELTME: "Hızlı İşlemler" yazısı kaldırıldı, sadece ikon kaldı -->
            <button type="button" onclick="toggleHizliIslemMenu()" class="inline-flex justify-center items-center w-full rounded-md border border-transparent shadow-sm px-3 py-2 bg-brand-600 text-sm font-medium text-white hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 transition-colors" id="menu-button" aria-expanded="true" aria-haspopup="true">
                <i class="fa-solid fa-bolt text-lg"></i>
                <i class="fa-solid fa-chevron-down ml-2 text-xs"></i>
            </button>
        </div>

        <div id="hizli-islem-menu" class="hidden origin-top-right absolute right-0 mt-2 w-64 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-50 divide-y divide-gray-100" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
            
            <div class="py-1" role="none">
                <a href="{{ url_for('main.panel') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-house w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Ana Panel
                </a>
            </div>

            <div class="py-1" role="none">
                <a href="{{ url_for('main.tedarikciler_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-users w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Tedarikçi Yönetimi
                </a>
                
                <a href="{{ url_for('tanker.tanker_yonetimi_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-truck-droplet w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Tanker Yönetimi
                </a>

                <a href="{{ url_for('yem.yem_yonetimi_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-wheat-awn w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Yem Yönetimi
                </a>
                <a href="{{ url_for('finans.finans_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-coins w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Finans Yönetimi
                </a>
                <a href="{{ url_for('main.raporlar_page') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-chart-line w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Detaylı Raporlar
                </a>
            </div>

            {% if session.get('user', {}).get('rol') in ['admin', 'firma_yetkilisi'] %}
            <div class="py-1" role="none">
                <a href="{{ url_for('firma.firma_yonetim_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-user-gear w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Kullanıcı Yönetimi
                </a>
                <a href="{{ url_for('tarife.tarife_yonetim_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-tags w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Süt Fiyat Tarifesi
                </a>
                <a href="{{ url_for('masraf.masraf_yonetim_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-wallet w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Genel Masraf Yönetimi
                </a>
            </div>
            {% endif %}

            <div class="py-1" role="none">
                <!-- DÜZELTME: type="button" eklendi ki form submit sanmasın -->
                <button type="button" class="w-full text-left text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" onclick="openGlobalHakkinda()">
                    <i class="fa-solid fa-circle-info w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Uygulama Hakkında
                </button>
                
                {% if session.get('user', {}).get('rol') == 'admin' %}
                <a href="{{ url_for('admin.admin_panel') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-shield-halved w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Admin Paneli
                </a>
                {% endif %}
            </div>

            <div class="py-1" role="none">
                <a href="{{ url_for('profil.profil_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-user w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Profilim
                </a>
                <button type="button" class="w-full text-left text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" onclick="if(typeof askForNotificationPermission === 'function') askForNotificationPermission()">
                    <i class="fa-solid fa-bell w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Bildirimleri Aç
                </button>
                <button type="button" class="w-full text-left text-red-600 hover:bg-red-50 hover:text-red-700 group flex items-center px-4 py-2 text-sm" onclick="if(typeof guvenliCikis === 'function') guvenliCikis()">
                    <i class="fa-solid fa-right-from-bracket w-5 text-center mr-2 text-red-400 group-hover:text-red-600"></i> Güvenli Çıkış
                </button>
            </div>
        </div>
    </div>

    <button id="theme-toggle" class="p-2 text-gray-500 hover:text-brand-600 transition-colors rounded-full hover:bg-gray-100 focus:outline-none border border-gray-200 shadow-sm bg-white">
        <i id="sun-icon" class="fa-solid fa-sun text-yellow-500 hidden"></i>
        <i id="moon-icon" class="fa-solid fa-moon text-brand-600"></i>
    </button>

</div>

<script>
    // Dropdown Açma/Kapama
    function toggleHizliIslemMenu() {
        const menu = document.getElementById('hizli-islem-menu');
        if (menu) {
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                menu.classList.add('transition', 'ease-out', 'duration-100', 'transform', 'opacity-100', 'scale-100');
            } else {
                menu.classList.add('hidden');
            }
        }
    }

    // Dışarı tıklandığında menüyü kapat
    window.addEventListener('click', function(e) {
        const container = document.getElementById('hizli-islem-container');
        const menu = document.getElementById('hizli-islem-menu');
        // Butona tıklanmadıysa kapat
        if (container && !container.contains(e.target) && menu && !menu.classList.contains('hidden')) {
            menu.classList.add('hidden');
        }
    });

    // Güvenli Çıkış Fonksiyonu
    function guvenliCikis() {
        localStorage.removeItem('offlineUser');
        window.location.href = "{{ url_for('auth.logout') }}";
    }
    
    // Bildirim İzni
    function askForNotificationPermission() {
        if ('Notification' in window) {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    alert("Bildirim izni verildi!");
                }
            });
        } else {
            alert("Tarayıcınız bildirimleri desteklemiyor.");
        }
    }
</script>
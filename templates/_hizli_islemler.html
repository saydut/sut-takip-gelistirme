<!-- templates/_hizli_islemler.html -->

<div class="flex items-center space-x-2">

    <div class="relative inline-block text-left" id="hizli-islem-container">
        <div>
            <button type="button" onclick="toggleHizliIslemMenu()" class="inline-flex justify-center items-center w-full rounded-md border border-transparent shadow-sm px-3 py-2 bg-brand-600 text-sm font-medium text-white hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 transition-colors" id="menu-button" aria-expanded="true" aria-haspopup="true">
                <i class="fa-solid fa-bolt text-lg"></i>
                <i class="fa-solid fa-chevron-down ml-2 text-xs"></i>
            </button>
        </div>

        <div id="hizli-islem-menu" class="hidden origin-top-right absolute right-0 mt-2 w-64 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-50 divide-y divide-gray-100" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
            
            <div class="py-1" role="none">
                <a href="{{ url_for('main.panel') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-house w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Ana Panel
                </a>
            </div>

            <div class="py-1" role="none">
                <a href="{{ url_for('main.tedarikciler_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-users w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Tedarikçi Yönetimi
                </a>
                
                <a href="{{ url_for('tanker.tanker_yonetimi_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-truck-droplet w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Tanker Yönetimi
                </a>

                <a href="{{ url_for('yem.yem_yonetimi_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-wheat-awn w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Yem Yönetimi
                </a>
                <a href="{{ url_for('finans.finans_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-coins w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Finans Yönetimi
                </a>
                <a href="{{ url_for('main.raporlar_page') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-chart-line w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Detaylı Raporlar
                </a>
            </div>

            {% if session.get('user', {}).get('rol') in ['admin', 'firma_yetkilisi'] %}
            <div class="py-1" role="none">
                <a href="{{ url_for('firma.firma_yonetim_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-user-gear w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Kullanıcı Yönetimi
                </a>
                <a href="{{ url_for('tarife.tarife_yonetim_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-tags w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Süt Fiyat Tarifesi
                </a>
                <a href="{{ url_for('masraf.masraf_yonetim_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-wallet w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Genel Masraf Yönetimi
                </a>
            </div>
            {% endif %}

            <div class="py-1" role="none">
                <button type="button" class="w-full text-left text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" onclick="openGlobalHakkinda()">
                    <i class="fa-solid fa-circle-info w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Uygulama Hakkında
                </button>
                
                {% if session.get('user', {}).get('rol') == 'admin' %}
                <a href="{{ url_for('admin.admin_panel') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-shield-halved w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Admin Paneli
                </a>
                {% endif %}
            </div>

            <div class="py-1" role="none">
                <a href="{{ url_for('profil.profil_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-user w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Profilim
                </a>
                <button type="button" class="w-full text-left text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" onclick="if(typeof askForNotificationPermission === 'function') askForNotificationPermission()">
                    <i class="fa-solid fa-bell w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Bildirimleri Aç
                </button>
                <button type="button" class="w-full text-left text-red-600 hover:bg-red-50 hover:text-red-700 group flex items-center px-4 py-2 text-sm" onclick="if(typeof guvenliCikis === 'function') guvenliCikis()">
                    <i class="fa-solid fa-right-from-bracket w-5 text-center mr-2 text-red-400 group-hover:text-red-600"></i> Güvenli Çıkış
                </button>
            </div>
        </div>
    </div>

    <button id="theme-toggle" class="p-2 text-gray-500 hover:text-brand-600 transition-colors rounded-full hover:bg-gray-100 focus:outline-none border border-gray-200 shadow-sm bg-white">
        <i id="sun-icon" class="fa-solid fa-sun text-yellow-500 hidden"></i>
        <i id="moon-icon" class="fa-solid fa-moon text-brand-600"></i>
    </button>

</div>

<!-- ================================================================== -->
<!-- GLOBAL HAKKINDA MODALI (ÖZELLİKLER SEKMESİ İLE) -->
<!-- ================================================================== -->
<div id="global-hakkinda-modal" class="fixed inset-0 z-[9999] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <!-- Arkaplan Karartma -->
    <div class="fixed inset-0 bg-gray-900/75 backdrop-blur-sm transition-opacity" onclick="closeGlobalHakkinda()"></div>

    <div class="fixed inset-0 z-[10000] w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <!-- Modal İçeriği -->
            <div class="relative transform overflow-hidden rounded-2xl bg-white dark:bg-slate-800 text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg scale-95 opacity-0 transition-all duration-300 ease-out border border-gray-100 dark:border-slate-700" id="hakkinda-modal-content">
                
                <!-- Başlık Kısmı -->
                <div class="bg-brand-600 dark:bg-brand-700 px-4 py-6 sm:px-6 relative overflow-hidden text-center">
                    <!-- Dekoratif Arkaplan İkonu -->
                    <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
                        <i class="fa-solid fa-cow text-9xl text-white transform -rotate-12 translate-x-1/2"></i>
                    </div>

                    <div class="relative z-10 flex flex-col items-center justify-center">
                         <div class="h-16 w-16 bg-white/20 backdrop-blur-sm rounded-full flex items-center justify-center mb-3 shadow-inner">
                            <i class="fa-solid fa-cow text-white text-3xl"></i>
                        </div>
                        <h3 class="text-xl font-bold leading-6 text-white" id="modal-title">Süt Takip Sistemi Hakkında</h3>
                    </div>
                    
                    <!-- Kapatma Butonu -->
                    <button type="button" onclick="closeGlobalHakkinda()" class="absolute top-4 right-4 text-white/80 hover:text-white transition-colors bg-white/10 hover:bg-white/20 rounded-full p-1.5 w-8 h-8 flex items-center justify-center cursor-pointer z-20">
                        <i class="fa-solid fa-xmark text-lg"></i>
                    </button>
                </div>

                <!-- Sekme Butonları -->
                <div class="border-b border-gray-200 dark:border-gray-700">
                    <nav class="-mb-px flex" aria-label="Tabs">
                        <button onclick="switchAboutTab('ozellikler')" id="btn-tab-ozellikler" class="flex-1 py-4 px-1 text-center border-b-2 font-medium text-sm border-brand-500 text-brand-600 dark:text-brand-400">
                            Özellikler & Kullanım
                        </button>
                        <button onclick="switchAboutTab('surum')" id="btn-tab-surum" class="flex-1 py-4 px-1 text-center border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200">
                            Sürüm Notları
                        </button>
                        <button onclick="switchAboutTab('iletisim')" id="btn-tab-iletisim" class="flex-1 py-4 px-1 text-center border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-200">
                            İletişim & Destek
                        </button>
                    </nav>
                </div>

                <!-- İçerik Gövdesi -->
                <div class="px-6 py-6 max-h-[60vh] overflow-y-auto">
                    
                    <!-- SEKME 1: ÖZELLİKLER (YENİ) -->
                    <div id="tab-content-ozellikler" class="space-y-4">
                        <div class="text-center mb-6">
                            <span class="inline-flex items-center rounded-full bg-brand-50 dark:bg-brand-900/50 px-3 py-1 text-xs font-medium text-brand-700 dark:text-brand-300 ring-1 ring-inset ring-brand-700/10">
                                Sürüm v{{ APP_VERSION }}
                            </span>
                            <p class="mt-3 text-sm text-gray-600 dark:text-gray-300 leading-relaxed">
                                Süt toplama süreçlerinizi dijitalleştirin, finansal takibinizi kolaylaştırın ve verimliliğinizi artırın.
                            </p>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <!-- Süt Takibi -->
                            <div class="p-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-slate-800/50 text-center hover:border-brand-300 dark:hover:border-brand-600 transition-colors group">
                                <div class="w-10 h-10 mx-auto bg-white dark:bg-slate-700 rounded-full flex items-center justify-center shadow-sm mb-3 text-brand-600 dark:text-brand-400 group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-bucket text-lg"></i>
                                </div>
                                <h4 class="font-bold text-gray-900 dark:text-white text-sm mb-1">Süt Takibi</h4>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Litre ve fiyat kaydı</p>
                            </div>

                            <!-- Finans -->
                            <div class="p-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-slate-800/50 text-center hover:border-green-300 dark:hover:border-green-600 transition-colors group">
                                <div class="w-10 h-10 mx-auto bg-white dark:bg-slate-700 rounded-full flex items-center justify-center shadow-sm mb-3 text-green-600 dark:text-green-400 group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-coins text-lg"></i>
                                </div>
                                <h4 class="font-bold text-gray-900 dark:text-white text-sm mb-1">Finans</h4>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Alacak/Verecek</p>
                            </div>

                            <!-- Raporlar -->
                            <div class="p-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-slate-800/50 text-center hover:border-purple-300 dark:hover:border-purple-600 transition-colors group">
                                <div class="w-10 h-10 mx-auto bg-white dark:bg-slate-700 rounded-full flex items-center justify-center shadow-sm mb-3 text-purple-600 dark:text-purple-400 group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-file-pdf text-lg"></i>
                                </div>
                                <h4 class="font-bold text-gray-900 dark:text-white text-sm mb-1">Raporlar</h4>
                                <p class="text-xs text-gray-500 dark:text-gray-400">PDF & Detaylı Analiz</p>
                            </div>

                            <!-- Çevrimdışı -->
                            <div class="p-4 rounded-xl border border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-slate-800/50 text-center hover:border-orange-300 dark:hover:border-orange-600 transition-colors group">
                                <div class="w-10 h-10 mx-auto bg-white dark:bg-slate-700 rounded-full flex items-center justify-center shadow-sm mb-3 text-orange-600 dark:text-orange-400 group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-wifi text-lg"></i>
                                </div>
                                <h4 class="font-bold text-gray-900 dark:text-white text-sm mb-1">Çevrimdışı</h4>
                                <p class="text-xs text-gray-500 dark:text-gray-400">İnternetsiz Çalışma</p>
                            </div>
                        </div>
                    </div>

                    <!-- SEKME 2: SÜRÜM NOTLARI -->
                    <div id="tab-content-surum" class="hidden space-y-4">
                        <div class="flex justify-between items-center mb-4">
                            <div>
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Mevcut Sürüm:</p>
                                <p class="text-xl font-bold text-gray-900 dark:text-white">{{ APP_VERSION }}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-medium text-gray-500 dark:text-gray-400">Son Güncelleme:</p>
                                <p class="text-sm text-gray-700 dark:text-gray-300">{{ today | format_tarih }}</p>
                            </div>
                        </div>

                        <div class="space-y-2">
                            {% for surum_notu in SURUM_NOTLARI %}
                            <details class="group border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-slate-700/50 open:bg-white dark:open:bg-slate-800 transition-all duration-200">
                                <summary class="flex cursor-pointer items-center justify-between p-3.5 font-medium text-gray-900 dark:text-gray-100 select-none">
                                    <div class="flex items-center gap-3">
                                        <span class="text-sm font-bold">Sürüm {{ surum_notu.surum_no }}</span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400 hidden sm:inline-block">- ({{ surum_notu.yayin_tarihi | format_tarih }})</span>
                                    </div>
                                    <span class="transition-transform duration-200 group-open:rotate-180">
                                        <i class="fa-solid fa-chevron-down text-xs text-gray-400"></i>
                                    </span>
                                </summary>
                                <div class="border-t border-gray-200 dark:border-gray-700 p-4 text-sm text-gray-600 dark:text-gray-300 bg-white dark:bg-slate-800 rounded-b-lg">
                                    <ul class="list-disc list-inside space-y-1.5 marker:text-brand-500">
                                        {% for satir in surum_notu.notlar.split('\n') %}
                                            {% if satir.strip() %}
                                                <li>{{ satir.strip().replace('- ', '') }}</li>
                                            {% endif %}
                                        {% endfor %}
                                    </ul>
                                </div>
                            </details>
                            {% else %}
                                <div class="text-center py-4 text-gray-500 dark:text-gray-400">Henüz sürüm notu bulunmamaktadır.</div>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- SEKME 3: İLETİŞİM -->
                    <div id="tab-content-iletisim" class="hidden space-y-6 text-center">
                        <div class="bg-brand-50 dark:bg-slate-700/50 p-6 rounded-xl border border-brand-100 dark:border-slate-600">
                            <div class="w-16 h-16 bg-white dark:bg-slate-800 rounded-full flex items-center justify-center mx-auto mb-4 shadow-sm">
                                <img src="{{ url_for('static', filename='images/icon.png') }}" class="w-10 h-10" alt="Logo">
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-2">Dijital Mandıra</h3>
                            <p class="text-sm text-gray-600 dark:text-gray-300 mb-6">
                                Süt toplama süreçlerinizi dijitalleştirin, finansal takibinizi kolaylaştırın ve verimliliğinizi artırın.
                            </p>
                            
                            <a href="https://wa.me/905539571515" target="_blank" class="inline-flex items-center justify-center w-full bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-lg transition-colors shadow-sm">
                                <i class="fa-brands fa-whatsapp text-xl mr-2"></i> WhatsApp Destek Hattı
                            </a>
                        </div>

                        <div class="text-xs text-gray-400 dark:text-gray-500">
                            <p>&copy; 2025 Dijital Mandıra Yazılım Çözümleri</p>
                            <p class="mt-1">Tüm hakları saklıdır.</p>
                        </div>
                    </div>

                </div>
                
                <!-- Footer -->
                <div class="bg-gray-50 dark:bg-slate-900/50 px-4 py-3 sm:px-6 flex justify-end border-t border-gray-100 dark:border-slate-700">
                    <button type="button" onclick="closeGlobalHakkinda()" class="w-full inline-flex justify-center rounded-lg border border-gray-300 dark:border-slate-600 shadow-sm px-4 py-2 bg-white dark:bg-slate-800 text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-slate-700 sm:w-auto sm:text-sm transition-colors">
                        Kapat
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Dropdown Açma/Kapama
    function toggleHizliIslemMenu() {
        const menu = document.getElementById('hizli-islem-menu');
        if (menu) {
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                // Basit fade-in efekti
                menu.style.opacity = '0';
                menu.style.transform = 'scale(0.95)';
                requestAnimationFrame(() => {
                    menu.style.transition = 'all 0.1s ease-out';
                    menu.style.opacity = '1';
                    menu.style.transform = 'scale(1)';
                });
            } else {
                menu.classList.add('hidden');
            }
        }
    }

    // Dışarı tıklandığında menüyü kapat
    window.addEventListener('click', function(e) {
        const container = document.getElementById('hizli-islem-container');
        const menu = document.getElementById('hizli-islem-menu');
        // Butona tıklanmadıysa kapat
        if (container && !container.contains(e.target) && menu && !menu.classList.contains('hidden')) {
            menu.classList.add('hidden');
        }
    });

    // Güvenli Çıkış Fonksiyonu
    function guvenliCikis() {
        localStorage.removeItem('offlineUser');
        window.location.href = "{{ url_for('auth.logout') }}";
    }
    
    // Bildirim İzni
    function askForNotificationPermission() {
        if ('Notification' in window) {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    alert("Bildirim izni verildi!");
                }
            });
        } else {
            alert("Tarayıcınız bildirimleri desteklemiyor.");
        }
    }

    // --- HAKKINDA MODAL MANTIĞI ---
    
    document.addEventListener("DOMContentLoaded", function() {
        const modal = document.getElementById('global-hakkinda-modal');
        if (modal && document.body) {
            document.body.appendChild(modal);
        }
    });

    window.openGlobalHakkinda = function() {
        const modal = document.getElementById('global-hakkinda-modal');
        if (modal) {
            modal.classList.remove('hidden');
            
            // Her açılışta varsayılan olarak 'Özellikler' sekmesini aç
            switchAboutTab('ozellikler');

            const innerDiv = document.getElementById('hakkinda-modal-content');
            if(innerDiv) {
                setTimeout(() => {
                    innerDiv.classList.add('scale-100', 'opacity-100');
                    innerDiv.classList.remove('scale-95', 'opacity-0');
                }, 10);
            }
        }
    };

    window.closeGlobalHakkinda = function() {
        const modal = document.getElementById('global-hakkinda-modal');
        if (modal) {
            const innerDiv = document.getElementById('hakkinda-modal-content');
            if(innerDiv) {
                innerDiv.classList.remove('scale-100', 'opacity-100');
                innerDiv.classList.add('scale-95', 'opacity-0');
                setTimeout(() => { modal.classList.add('hidden'); }, 300);
            } else {
                modal.classList.add('hidden');
            }
        }
    };

    // --- TAB GEÇİŞ MANTIĞI ---
    window.switchAboutTab = function(tabName) {
        // İçerikleri yönet
        const contents = ['ozellikler', 'surum', 'iletisim'];
        contents.forEach(content => {
            document.getElementById(`tab-content-${content}`).classList.toggle('hidden', tabName !== content);
        });

        // Buton stillerini yönet
        const btns = ['ozellikler', 'surum', 'iletisim'];
        
        // Aktif stil
        const activeClass = ['border-brand-500', 'text-brand-600', 'dark:text-brand-400'];
        // Pasif stil
        const inactiveClass = ['border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-200'];

        btns.forEach(btnName => {
            const btn = document.getElementById(`btn-tab-${btnName}`);
            if (btnName === tabName) {
                btn.classList.add(...activeClass);
                btn.classList.remove(...inactiveClass);
            } else {
                btn.classList.remove(...activeClass);
                btn.classList.add(...inactiveClass);
            }
        });
    };

    // ESC tuşu desteği
    document.addEventListener('keydown', function(event) {
        if (event.key === "Escape") {
            if (typeof window.closeGlobalHakkinda === 'function') {
                window.closeGlobalHakkinda();
            }
        }
    });
</script>
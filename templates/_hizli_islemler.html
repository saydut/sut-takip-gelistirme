<!-- templates/_hizli_islemler.html -->

<div class="flex items-center space-x-2">

    <div class="relative inline-block text-left" id="hizli-islem-container">
        <div>
            <button type="button" onclick="toggleHizliIslemMenu()" class="inline-flex justify-center items-center w-full rounded-md border border-transparent shadow-sm px-3 py-2 bg-brand-600 text-sm font-medium text-white hover:bg-brand-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-brand-500 transition-colors" id="menu-button" aria-expanded="true" aria-haspopup="true">
                <i class="fa-solid fa-bolt text-lg"></i>
                <i class="fa-solid fa-chevron-down ml-2 text-xs"></i>
            </button>
        </div>

        <div id="hizli-islem-menu" class="hidden origin-top-right absolute right-0 mt-2 w-64 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-50 divide-y divide-gray-100" role="menu" aria-orientation="vertical" aria-labelledby="menu-button" tabindex="-1">
            
            <div class="py-1" role="none">
                <a href="{{ url_for('main.panel') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-house w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Ana Panel
                </a>
            </div>

            <div class="py-1" role="none">
                <a href="{{ url_for('main.tedarikciler_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-users w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Tedarikçi Yönetimi
                </a>
                
                <a href="{{ url_for('tanker.tanker_yonetimi_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-truck-droplet w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Tanker Yönetimi
                </a>

                <a href="{{ url_for('yem.yem_yonetimi_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-wheat-awn w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Yem Yönetimi
                </a>
                <a href="{{ url_for('finans.finans_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-coins w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Finans Yönetimi
                </a>
                <a href="{{ url_for('main.raporlar_page') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-chart-line w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Detaylı Raporlar
                </a>
            </div>

            {% if session.get('user', {}).get('rol') in ['admin', 'firma_yetkilisi'] %}
            <div class="py-1" role="none">
                <a href="{{ url_for('firma.firma_yonetim_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-user-gear w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Kullanıcı Yönetimi
                </a>
                <a href="{{ url_for('tarife.tarife_yonetim_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-tags w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Süt Fiyat Tarifesi
                </a>
                <a href="{{ url_for('masraf.masraf_yonetim_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-wallet w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Genel Masraf Yönetimi
                </a>
            </div>
            {% endif %}

            <div class="py-1" role="none">
                <button type="button" class="w-full text-left text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" onclick="openGlobalHakkinda()">
                    <i class="fa-solid fa-circle-info w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Uygulama Hakkında
                </button>
                
                {% if session.get('user', {}).get('rol') == 'admin' %}
                <a href="{{ url_for('admin.admin_panel') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-shield-halved w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Admin Paneli
                </a>
                {% endif %}
            </div>

            <div class="py-1" role="none">
                <a href="{{ url_for('profil.profil_sayfasi') }}" class="text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" role="menuitem">
                    <i class="fa-solid fa-user w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Profilim
                </a>
                <button type="button" class="w-full text-left text-gray-700 hover:bg-gray-50 hover:text-brand-600 group flex items-center px-4 py-2 text-sm" onclick="if(typeof askForNotificationPermission === 'function') askForNotificationPermission()">
                    <i class="fa-solid fa-bell w-5 text-center mr-2 text-gray-400 group-hover:text-brand-500"></i> Bildirimleri Aç
                </button>
                <button type="button" class="w-full text-left text-red-600 hover:bg-red-50 hover:text-red-700 group flex items-center px-4 py-2 text-sm" onclick="if(typeof guvenliCikis === 'function') guvenliCikis()">
                    <i class="fa-solid fa-right-from-bracket w-5 text-center mr-2 text-red-400 group-hover:text-red-600"></i> Güvenli Çıkış
                </button>
            </div>
        </div>
    </div>

    <button id="theme-toggle" class="p-2 text-gray-500 hover:text-brand-600 transition-colors rounded-full hover:bg-gray-100 focus:outline-none border border-gray-200 shadow-sm bg-white">
        <i id="sun-icon" class="fa-solid fa-sun text-yellow-500 hidden"></i>
        <i id="moon-icon" class="fa-solid fa-moon text-brand-600"></i>
    </button>

</div>

<!-- ================================================================== -->
<!-- GLOBAL HAKKINDA MODALI (Otomatik olarak her sayfaya eklenecek) -->
<!-- ================================================================== -->
<div id="global-hakkinda-modal" class="fixed inset-0 z-[9999] hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <!-- Arkaplan Karartma -->
    <div class="fixed inset-0 bg-gray-900/75 backdrop-blur-sm transition-opacity" onclick="closeGlobalHakkinda()"></div>

    <div class="fixed inset-0 z-[10000] w-screen overflow-y-auto">
        <div class="flex min-h-full items-end justify-center p-4 text-center sm:items-center sm:p-0">
            <!-- Modal İçeriği -->
            <div class="relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg scale-95 opacity-0 transition-all duration-300 ease-out" id="hakkinda-modal-content">
                
                <!-- Başlık Kısmı (Markalı) -->
                <div class="bg-brand-600 px-4 py-8 sm:px-6 text-center relative overflow-hidden">
                    <!-- Dekoratif Arkaplan İkonu -->
                    <div class="absolute top-0 left-0 w-full h-full opacity-10 pointer-events-none">
                        <i class="fa-solid fa-cow text-9xl text-white transform -rotate-12 translate-x-1/2"></i>
                    </div>
                    
                    <div class="relative z-10">
                        <div class="mx-auto flex h-20 w-20 items-center justify-center rounded-full bg-white/20 backdrop-blur-sm mb-4 shadow-inner ring-4 ring-white/10">
                            <i class="fa-solid fa-cow text-4xl text-white"></i>
                        </div>
                        <h3 class="text-2xl font-bold leading-6 text-white" id="modal-title">Dijital Mandıra</h3>
                        <p class="mt-2 text-sm text-brand-100 font-medium">Modern Çiftlik & Süt Yönetim Platformu</p>
                    </div>
                    
                    <!-- Kapatma Butonu -->
                    <button type="button" onclick="closeGlobalHakkinda()" class="absolute top-4 right-4 text-white/70 hover:text-white transition-colors bg-black/10 hover:bg-black/20 rounded-full p-2 w-8 h-8 flex items-center justify-center cursor-pointer z-20">
                        <i class="fa-solid fa-xmark text-lg"></i>
                    </button>
                </div>

                <!-- İçerik Gövdesi -->
                <div class="px-4 py-5 sm:p-6 bg-white">
                    <div class="space-y-6">
                        
                        <!-- Versiyon Bilgisi -->
                        <div class="text-center">
                            <span class="inline-flex items-center rounded-full bg-blue-50 px-3 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10 mb-3">
                                Sürüm v{{ APP_VERSION }}
                            </span>
                            <p class="text-sm text-gray-500 leading-relaxed">
                                Süt toplama süreçlerinizi dijitalleştirin, finansal takibinizi kolaylaştırın ve verimliliğinizi artırın.
                            </p>
                        </div>

                        <!-- Özellikler Grid -->
                        <div class="grid grid-cols-2 gap-4">
                            <div class="p-3 bg-slate-50 rounded-xl border border-slate-100 text-center hover:bg-brand-50 hover:border-brand-200 transition-all duration-300 group">
                                <div class="w-10 h-10 mx-auto bg-white rounded-full flex items-center justify-center shadow-sm mb-2 group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-bucket text-brand-500 text-lg"></i>
                                </div>
                                <h4 class="font-semibold text-gray-900 text-sm">Süt Takibi</h4>
                                <p class="text-[10px] text-gray-500 mt-0.5">Litre ve fiyat kaydı</p>
                            </div>
                            <div class="p-3 bg-slate-50 rounded-xl border border-slate-100 text-center hover:bg-green-50 hover:border-green-200 transition-all duration-300 group">
                                <div class="w-10 h-10 mx-auto bg-white rounded-full flex items-center justify-center shadow-sm mb-2 group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-coins text-green-500 text-lg"></i>
                                </div>
                                <h4 class="font-semibold text-gray-900 text-sm">Finans</h4>
                                <p class="text-[10px] text-gray-500 mt-0.5">Alacak/Verecek</p>
                            </div>
                            <div class="p-3 bg-slate-50 rounded-xl border border-slate-100 text-center hover:bg-purple-50 hover:border-purple-200 transition-all duration-300 group">
                                <div class="w-10 h-10 mx-auto bg-white rounded-full flex items-center justify-center shadow-sm mb-2 group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-file-pdf text-purple-500 text-lg"></i>
                                </div>
                                <h4 class="font-semibold text-gray-900 text-sm">Raporlar</h4>
                                <p class="text-[10px] text-gray-500 mt-0.5">PDF & Detaylı Analiz</p>
                            </div>
                            <div class="p-3 bg-slate-50 rounded-xl border border-slate-100 text-center hover:bg-orange-50 hover:border-orange-200 transition-all duration-300 group">
                                <div class="w-10 h-10 mx-auto bg-white rounded-full flex items-center justify-center shadow-sm mb-2 group-hover:scale-110 transition-transform">
                                    <i class="fa-solid fa-wifi text-orange-500 text-lg"></i>
                                </div>
                                <h4 class="font-semibold text-gray-900 text-sm">Çevrimdışı</h4>
                                <p class="text-[10px] text-gray-500 mt-0.5">İnternetsiz Çalışma</p>
                            </div>
                        </div>

                        <!-- İletişim -->
                        <div class="bg-gradient-to-r from-gray-50 to-white rounded-xl p-4 border border-gray-100">
                            <h4 class="text-sm font-bold text-gray-900 mb-3 text-center">İletişim & Destek</h4>
                            <div class="flex flex-col gap-2">
                                <a href="https://wa.me/905539571515" target="_blank" class="flex items-center justify-center w-full bg-green-50 text-green-700 hover:bg-green-100 hover:text-green-800 py-2 px-4 rounded-lg transition-colors text-sm font-medium border border-green-200">
                                    <i class="fa-brands fa-whatsapp text-lg mr-2"></i> WhatsApp Destek
                                </a>
                                <div class="text-center mt-2">
                                    <p class="text-xs text-gray-400">© 2025 Dijital Mandıra. Tüm Hakları Saklıdır.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Alt Çizgi (Dekoratif) -->
                <div class="h-1.5 w-full bg-gradient-to-r from-brand-400 via-brand-600 to-brand-400"></div>
            </div>
        </div>
    </div>
</div>

<script>
    // Dropdown Açma/Kapama
    function toggleHizliIslemMenu() {
        const menu = document.getElementById('hizli-islem-menu');
        if (menu) {
            if (menu.classList.contains('hidden')) {
                menu.classList.remove('hidden');
                // Basit fade-in efekti
                menu.style.opacity = '0';
                menu.style.transform = 'scale(0.95)';
                requestAnimationFrame(() => {
                    menu.style.transition = 'all 0.1s ease-out';
                    menu.style.opacity = '1';
                    menu.style.transform = 'scale(1)';
                });
            } else {
                menu.classList.add('hidden');
            }
        }
    }

    // Dışarı tıklandığında menüyü kapat
    window.addEventListener('click', function(e) {
        const container = document.getElementById('hizli-islem-container');
        const menu = document.getElementById('hizli-islem-menu');
        // Butona tıklanmadıysa kapat
        if (container && !container.contains(e.target) && menu && !menu.classList.contains('hidden')) {
            menu.classList.add('hidden');
        }
    });

    // Güvenli Çıkış Fonksiyonu
    function guvenliCikis() {
        localStorage.removeItem('offlineUser');
        window.location.href = "{{ url_for('auth.logout') }}";
    }
    
    // Bildirim İzni
    function askForNotificationPermission() {
        if ('Notification' in window) {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    alert("Bildirim izni verildi!");
                }
            });
        } else {
            alert("Tarayıcınız bildirimleri desteklemiyor.");
        }
    }

    // --- HAKKINDA MODAL MANTIĞI (BURAYA EKLENDİ) ---
    // Bu script, base.html kullanılmayan sayfalarda da modalın çalışmasını sağlar.
    
    // Modal DOM'a taşınsın ki z-index sorunları olmasın (özellikle sticky header'lı sayfalarda)
    document.addEventListener("DOMContentLoaded", function() {
        const modal = document.getElementById('global-hakkinda-modal');
        if (modal && document.body) {
            document.body.appendChild(modal);
        }
    });

    window.openGlobalHakkinda = function() {
        const modal = document.getElementById('global-hakkinda-modal');
        if (modal) {
            modal.classList.remove('hidden');
            const innerDiv = document.getElementById('hakkinda-modal-content');
            if(innerDiv) {
                setTimeout(() => {
                    innerDiv.classList.add('scale-100', 'opacity-100');
                    innerDiv.classList.remove('scale-95', 'opacity-0');
                }, 10);
            }
        } else {
            console.error("Hakkında modalı bulunamadı!");
        }
    };

    window.closeGlobalHakkinda = function() {
        const modal = document.getElementById('global-hakkinda-modal');
        if (modal) {
            const innerDiv = document.getElementById('hakkinda-modal-content');
            if(innerDiv) {
                innerDiv.classList.remove('scale-100', 'opacity-100');
                innerDiv.classList.add('scale-95', 'opacity-0');
                
                // Animasyon bitince gizle
                setTimeout(() => {
                    modal.classList.add('hidden');
                }, 300);
            } else {
                modal.classList.add('hidden');
            }
        }
    };

    // ESC tuşu desteği
    document.addEventListener('keydown', function(event) {
        if (event.key === "Escape") {
            if (typeof window.closeGlobalHakkinda === 'function') {
                window.closeGlobalHakkinda();
            }
        }
    });
</script>